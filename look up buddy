local UIS = game:GetService("UserInputService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local RunService = game:GetService("RunService")

-- Create the ScreenGui and Toggle Button
local screenGui = Instance.new("ScreenGui")
screenGui.Parent = LocalPlayer.PlayerGui

-- Function to create the Toggle Button
local function createToggleButton()
    -- Creating the Toggle Button UI
    local toggleButton = Instance.new("TextButton")
    toggleButton.Size = UDim2.new(0, 100, 0, 40)  -- Button size
    toggleButton.Position = UDim2.new(0, 20, 0, 20)  -- Top-left corner
    toggleButton.BackgroundColor3 = Color3.fromRGB(0, 0, 0)  -- Black background
    toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)  -- White text
    toggleButton.Text = "AntiLock Off"
    toggleButton.Parent = screenGui

    return toggleButton
end

-- Initialize the button
local toggleButton = createToggleButton()

local isAntiLockEnabled = false

-- Toggle the AntiLock state
toggleButton.MouseButton1Click:Connect(function()
    isAntiLockEnabled = not isAntiLockEnabled
    if isAntiLockEnabled then
        toggleButton.Text = "AntiLock On"
    else
        toggleButton.Text = "AntiLock Off"
    end
end)

-- Function to check if someone is locking onto you
local function handleCameraLock()
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Humanoid") then
            local humanoid = player.Character:FindFirstChild("Humanoid")
            local target = player.Character:FindFirstChild("HumanoidRootPart")

            if target then
                -- Detect if player is locking on you
                local screenPos, onScreen = Camera:WorldToViewportPoint(target.Position)
                if onScreen and isAntiLockEnabled then
                    -- If player locks on, adjust their camera to look up
                    local direction = Camera.CFrame:VectorToWorldSpace(Vector3.new(0, 10000, 0))
                    Camera.CFrame = CFrame.new(Camera.CFrame.Position, Camera.CFrame.Position + direction)
                end
            end
        end
    end
end

-- Check for camera lock every frame
RunService.RenderStepped:Connect(function()
    if isAntiLockEnabled then
        handleCameraLock()
    end
end)

-- Ensure toggle button is recreated if the player respawns
LocalPlayer.CharacterAdded:Connect(function()
    -- Destroy previous UI and create new one
    screenGui:ClearAllChildren()
    toggleButton = createToggleButton()
end)
